// ==UserScript==
// @name         blacket sexploit v2: collect friends
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  harass blacket chatters with friend requests.
// @author       acaiberii
// @match        https://blacket.org/chat
// @icon         https://www.google.com/s2/favicons?sz=64&domain=blacket.org
// @grant        unsafeWindow
// ==/UserScript==

(async () => {

await new Promise(res => {
    var ii;
    ii = setInterval(() => {
        if (unsafeWindow.blacket && unsafeWindow.blacket.socket && unsafeWindow.blacket.socket.on) {
            clearInterval(ii);
            res();
        }
    }, 1);
});

unsafeWindow.blacket.socket.on('chat', async d => {
    await fetch("https://blacket.org/worker/friends/request", {
        "headers": {
            "accept": "*/*",
            "accept-language": "en-US,en;q=0.9,ca;q=0.8",
            "content-type": "application/json",
            "sec-ch-ua": "\"Google Chrome\";v=\"111\", \"Not(A:Brand\";v=\"8\", \"Chromium\";v=\"111\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Windows\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "same-origin",
            "x-requested-with": "XMLHttpRequest"
        },
        "referrer": "https://blacket.org/stats?name="+d.user.username,
        "referrerPolicy": "strict-origin-when-cross-origin",
        "body": "{\"user\":\""+d.user.username+"\"}",
        "method": "POST",
        "mode": "cors",
        "credentials": "include"
    });
});

})();
